# π“ 1001eyes

<details>
<summary>λ©μ°¨</summary>

- [Overview](#Overview)
- [ERD](#ERD)
- [Architecture](#Architecture)
- [Tech Stack](#Tech-Stack)
- [Main Feature](#Main-Feature)
- [μ„±λ¥ κ°μ„ ](#μ„±λ¥-κ°μ„ )

[//]: # (- [Trouble Shooting]&#40;#Trouble-Shooting&#41;)

</details>


## Overview

1001eyesλ” ν•μ •ν μ ν’μ„ κµ¬λ§¤ν•λ” μƒν™©μ„ κΈ°λ°μΌλ΅ ν• μ΄μ»¤λ¨Έμ¤ ν”„λ΅μ νΈμ…λ‹λ‹¤. <br>
MSA κµ¬μ΅°λ¥Ό μ μ©ν•μ—¬ λ¨λ“ κ°„ λ…λ¦½μ„±μ„ κ°•ν™”ν•κ³  λ€κ·λ¨ νΈλν”½μ„ μ²λ¦¬ν•κΈ° μ„ν•΄ <br>
μ•μ •μ μΈ κµ¬λ§¤ ν”„λ΅μ„Έμ¤λ¥Ό μ κ³µν•λ” κ²ƒμ„ λ©ν‘λ΅ μ„¤κ³„λμ—μµλ‹λ‹¤.


- κ°λ° κΈ°κ°„: 2024/08/07 ~ 2024/09/04 (4μ£Ό)
- [API λ…μ„Έμ„](https://documenter.getpostman.com/view/33051866/2sA3s7ho4p)

## ERD
![img.png](etc/image/erd.png)


## Architecture

![μ λ© μ—†μ-2024-09-05-2035](https://github.com/user-attachments/assets/6d992906-e249-4d97-b705-cc28994c8472)


## Tech Stack
<details>
<summary>κΈ°μ  μ¤νƒ</summary>
  
| **Tech**       | **Usage**                  |
|----------------|----------------------------|
| **Language**   | Java 21                    |
| **Framework**  | Spring Boot 3.3.2          |
| **Build**      | Gradle                     |
| **Database**   | MySQL 8.0.30               |
| **ORM**        | Spring Data JPA            |
| **Cache**      | Redis (Redisson 3.21.0)    |
| **Cloud**      | Spring Cloud 2023.0.3      |
| **Service Discovery** | Spring Eureka       |
| **API Gateway**| Spring Cloud Gateway 4.1.5 |
| **Library**    | Feign Client               |
| **Library**    | JJWT (0.11.5)              |
| **Library**    | Spring Boot Mail (3.1.2)   |
| **Load Testing** | JMeter                   |
| **DevOps**     | Docker (25.0.3)            |

</details>


## Main Feature

- μ΄λ©”μΌ μΈμ¦μ„ ν†µν• νμ›κ°€μ…
  - Google SMTPλ¥Ό μ‚¬μ©ν•μ—¬ νμ›κ°€μ…μ‹ μΈμ¦ μ½”λ“ λ°μ†΅ κµ¬ν„

- κ°μΈμ •λ³΄ μ•”νΈν™” (AES μ•κ³ λ¦¬μ¦)
  - 16λ°”μ΄νΈ μ•”νΈν™” ν‚¤λ¥Ό ν†µν•΄ μ•”νΈν™” λ° λ³µνΈν™”
  - μ•”νΈν™”λ λ°μ΄ν„°λ” Base64 μΈμ½”λ”©μ„ ν†µν•΄ μ €μ¥

- Redis μΊμ‹±μ„ ν†µν• μ¬κ³  κ΄€λ¦¬
  - μƒν’ μ¬κ³ λ¥Ό μΊμ‹±ν•μ—¬ rdb λ³΄λ‹¤ κ°€λ²Όμ΄ μ΅°ν κΈ°λ¥ μ κ³µ 
  - Redis λ¶„μ‚°λ½(Redissonμ rLock)μ„ ν™μ©ν•μ—¬ μ¬κ³  μ°¨κ° μ‹ λ™μ‹μ„± λ¬Έμ  ν•΄μ†

- νμΈ ν΄λΌμ΄μ–ΈνΈλ¥Ό ν†µν• μ„λΉ„μ¤ κ°„ ν†µμ‹ 
  - λ§μ΄ν¬λ΅μ„λΉ„μ¤ κ°„μ ν¨μ¨μ μΈ ν†µμ‹ μ„ μ„ν•΄ API νΈμ¶μ„ κ°„νΈν•κ² κµ¬ν„

- Netflix Eurekaλ¥Ό μ΄μ©ν• Client-side Discovery λ°©μ‹μ Service Discovery κµ¬ν„
  - Eureka μ„λ²„λ¥Ό ν†µν•΄ μ„λΉ„μ¤ λ“±λ΅ λ° κ²€μƒ‰ κ°€λ¥
  - Eureka ν΄λΌμ΄μ–ΈνΈλ΅ μ„λΉ„μ¤ κ°„ λ™μ  λ΅λ“ λ°Έλ°μ‹± μ κ³µ


- API κ²μ΄νΈμ›¨μ΄λ¥Ό ν†µν• λΌμ°ν… λ° μΈκ°€ κΈ°λ¥
    - λ§μ΄ν¬λ΅μ„λΉ„μ¤ κ°„μ κ²½λ΅ μ„¤μ •μ„ ν†µν•΄ ν΄λΌμ΄μ–ΈνΈ μ”μ²­μ„ μ μ ν λ¶„λ°°
    - JWT ν† ν°μ„ μ‚¬μ©ν• μΈκ°€ ν•„ν„° μ μ©  

- μ¤ν”„λ§ μ¤μΌ€μ¤„λ¬λ¥Ό ν™μ©ν• μƒνƒ κ΄€λ¦¬
  - μ£ΌκΈ°μ μΈ μ£Όλ¬Έ μƒνƒ μ—…λ°μ΄νΈ κµ¬ν„
  - μ„μ‹ μ£Όλ¬Έλ°μ΄ν„° TTL λ§λ£μ‹ μΊμ‹± μ¬κ³  λ³µκµ¬ λ΅μ§
  - slack μ•λ¦Ό μ „μ†΅μΌλ΅ λ¨λ‹ν„°λ§


## μ„±λ¥ κ°μ„ 

### μ£Όλ¬Έ μ§„μ… λ΅μ§ λ¦¬ν©ν† λ§

- **[Before]** DB μ§μ ‘ μ΅°ν + μ£Όλ¬Έ λ°μ΄ν„° dbμ— μ €μ¥
- **[After]** μ¬κ³  μΊμ‹± ν™μ© + μ„μ‹ μ£Όλ¬Έ λ°μ΄ν„° λ λ””μ¤μ— μ €μ¥
  - Look-aside μΊμ‹± μ „λµ μ μ© : ν‰κ·  μ‘λ‹µ μ†λ„ **μ•½ 99% (1666ms β†’ 10ms)** ν–¥μƒ

### κµ¬λ§¤ ν”„λ΅μ„Έμ¤ μ΄νƒ μƒν™© μ²λ¦¬

- μ£Όλ¬Έ μ§„μ… μƒνƒ (PENDING), κ²°μ  μ§„μ… μƒνƒ (PAYING)λ΅ 10λ¶„ κ²½κ³Όμ‹ <br>
  κµ¬λ§¤ μμ‚¬ μ—†λ‹¤κ³  κ°€μ • -> μ¤μΌ€μ¤„λ¬λ΅ λ λ””μ¤ TTL μ²΄ν¬ ν›„ μ„μ‹ μ£Όλ¬Έ λ°μ΄ν„° μ κ±° λ° μ¬κ³  λ³µκµ¬

### λ™μ‹μ„± λ¬Έμ  ν•΄μ†

- λΉ„κ΄€μ  λ½ / λ¶„μ‚° λ½ μ μ© ν›„ μ£Όλ¬Έ λ°μ΄ν„° λ° μ¬κ³  μ •ν•©μ„± μ μ§€
- λ¶€ν• ν…μ¤νΈ
  - ν…μ¤νΈ μ‹λ‚λ¦¬μ¤ 1 : 1λ§λ… μ”μ²­, μƒν’ μ¬κ³  : 1λ§κ° -> μμƒ κ²°κ³Ό (μ—λ¬x λ° 1λ§κ±΄μ μ£Όλ¬Έ λ°μ΄ν„° μƒμ„± λ° μ¬κ³  μΌμΉ)
  - ν…μ¤νΈ μ‹λ‚λ¦¬μ¤ 2 : 1λ§λ… μ”μ²­, μƒν’ μ¬κ³  : 10κ° -> μμƒ κ²°κ³Ό (99.90% μ—λ¬ λ° 10λ…λ§ μ£Όλ¬Έμ— μ„±κ³µν•λ‹¤.)
  - [ν…μ¤νΈ κ²°κ³Ό λ§ν¬](https://github.com/hhhyeon97/1001eyes/wiki/%EB%B6%80%ED%95%98%ED%85%8C%EC%8A%A4%ED%8A%B8-%EA%B2%B0%EA%B3%BC)


[//]: # (## Trouble Shooting)

<!--
<div align="right">

[λ§¨ μ„λ΅](#1001eyes)

</div> -->
